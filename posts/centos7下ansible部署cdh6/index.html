<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Centos7下Ansible部署CDH6 1.Ansible配置  pip安装  mkdir /root/.pip &amp;&amp; echo &#39;[global]&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; echo &#39;index-url = https://mirrors.aliyun.com/pypi/simple&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; curl http://10.251.35.58:8900/pip/get-pip.py -o get-pip.py &amp;&amp; python get-pip.py  ansible安装  pip install ansible  ansible配置  vim ~/.bash_profile export ANSIBLE_CONFIG=/etc/ansible/ansible.cfg mkdir /etc/ansible/ &amp;&amp; vim /etc/ansible/ansible.cfg [defaults] inventory = /etc/ansible/hosts host_key_checking = False remote_user = root  配置hosts  vim /etc/ansible/hosts [cdh] 10.251.35.80 10.251.35.81 10.251.35.83 10.251.35.85 10.251.35.86  配置Ansible免密登录  ssh-keygen -t rsa -P &#39;&#39; -f .">
    <meta name="generator" content="Hugo 0.81.0-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="" />
<meta property="og:description" content="Centos7下Ansible部署CDH6 1.Ansible配置  pip安装  mkdir /root/.pip &amp;&amp; echo &#39;[global]&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; echo &#39;index-url = https://mirrors.aliyun.com/pypi/simple&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; curl http://10.251.35.58:8900/pip/get-pip.py -o get-pip.py &amp;&amp; python get-pip.py  ansible安装  pip install ansible  ansible配置  vim ~/.bash_profile export ANSIBLE_CONFIG=/etc/ansible/ansible.cfg mkdir /etc/ansible/ &amp;&amp; vim /etc/ansible/ansible.cfg [defaults] inventory = /etc/ansible/hosts host_key_checking = False remote_user = root  配置hosts  vim /etc/ansible/hosts [cdh] 10.251.35.80 10.251.35.81 10.251.35.83 10.251.35.85 10.251.35.86  配置Ansible免密登录  ssh-keygen -t rsa -P &#39;&#39; -f ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/centos7%E4%B8%8Bansible%E9%83%A8%E7%BD%B2cdh6/" />

<meta itemprop="name" content="">
<meta itemprop="description" content="Centos7下Ansible部署CDH6 1.Ansible配置  pip安装  mkdir /root/.pip &amp;&amp; echo &#39;[global]&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; echo &#39;index-url = https://mirrors.aliyun.com/pypi/simple&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; curl http://10.251.35.58:8900/pip/get-pip.py -o get-pip.py &amp;&amp; python get-pip.py  ansible安装  pip install ansible  ansible配置  vim ~/.bash_profile export ANSIBLE_CONFIG=/etc/ansible/ansible.cfg mkdir /etc/ansible/ &amp;&amp; vim /etc/ansible/ansible.cfg [defaults] inventory = /etc/ansible/hosts host_key_checking = False remote_user = root  配置hosts  vim /etc/ansible/hosts [cdh] 10.251.35.80 10.251.35.81 10.251.35.83 10.251.35.85 10.251.35.86  配置Ansible免密登录  ssh-keygen -t rsa -P &#39;&#39; -f .">

<meta itemprop="wordCount" content="782">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Centos7下Ansible部署CDH6 1.Ansible配置  pip安装  mkdir /root/.pip &amp;&amp; echo &#39;[global]&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; echo &#39;index-url = https://mirrors.aliyun.com/pypi/simple&#39; &gt;&gt; /root/.pip/pip.conf &amp;&amp; curl http://10.251.35.58:8900/pip/get-pip.py -o get-pip.py &amp;&amp; python get-pip.py  ansible安装  pip install ansible  ansible配置  vim ~/.bash_profile export ANSIBLE_CONFIG=/etc/ansible/ansible.cfg mkdir /etc/ansible/ &amp;&amp; vim /etc/ansible/ansible.cfg [defaults] inventory = /etc/ansible/hosts host_key_checking = False remote_user = root  配置hosts  vim /etc/ansible/hosts [cdh] 10.251.35.80 10.251.35.81 10.251.35.83 10.251.35.85 10.251.35.86  配置Ansible免密登录  ssh-keygen -t rsa -P &#39;&#39; -f ."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=http://example.org/posts/centos7%E4%B8%8Bansible%E9%83%A8%E7%BD%B2cdh6/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=http://example.org/posts/centos7%E4%B8%8Bansible%E9%83%A8%E7%BD%B2cdh6/&amp;text=" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://example.org/posts/centos7%E4%B8%8Bansible%E9%83%A8%E7%BD%B2cdh6/&amp;title=" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1"></h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="0001-01-01T00:00:00Z">January 1, 0001</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h3 id="centos7下ansible部署cdh6">Centos7下Ansible部署CDH6</h3>
<h4 id="1ansible配置">1.Ansible配置</h4>
<ul>
<li>pip安装</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /root/.pip <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#39;[global]&#39;</span> &gt;&gt;  /root/.pip/pip.conf <span style="color:#f92672">&amp;&amp;</span>   echo <span style="color:#e6db74">&#39;index-url = https://mirrors.aliyun.com/pypi/simple&#39;</span> &gt;&gt;  /root/.pip/pip.conf <span style="color:#f92672">&amp;&amp;</span>   curl http://10.251.35.58:8900/pip/get-pip.py -o get-pip.py <span style="color:#f92672">&amp;&amp;</span> python get-pip.py
</code></pre></div><ul>
<li>ansible安装</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install ansible
</code></pre></div><ul>
<li>ansible配置</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim ~/.bash_profile
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export ANSIBLE_CONFIG<span style="color:#f92672">=</span>/etc/ansible/ansible.cfg
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /etc/ansible/ <span style="color:#f92672">&amp;&amp;</span> vim /etc/ansible/ansible.cfg
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>defaults<span style="color:#f92672">]</span>
inventory      <span style="color:#f92672">=</span> /etc/ansible/hosts
host_key_checking <span style="color:#f92672">=</span> False
remote_user <span style="color:#f92672">=</span> root
</code></pre></div><ul>
<li>配置hosts</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /etc/ansible/hosts
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>cdh<span style="color:#f92672">]</span>
10.251.35.80
10.251.35.81
10.251.35.83
10.251.35.85
10.251.35.86
</code></pre></div><ul>
<li>配置Ansible免密登录</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh-keygen -t rsa -P <span style="color:#e6db74">&#39;&#39;</span> -f ./id_rsa -C cm@10.251.35.1
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m authorized_key -a key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ lookup(&#39;file&#39;, &#39;~/.ssh/id_rsa.pub&#39;) }} user=root&#34;</span> --ask-pass -u root
</code></pre></div><p><strong>回收权限</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m authorized_key -a key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ lookup(&#39;file&#39;, &#39;~/id_rsa.pub&#39;) }} user=root state=absent&#34;</span>  -u root
</code></pre></div><ul>
<li>分发hosts</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m copy -a <span style="color:#e6db74">&#39;src=/etc/hosts dest=/etc/hosts&#39;</span> 
</code></pre></div><h4 id="2卸载不必要的软件">2.卸载不必要的软件</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;yum remove -y $(rpm -qa|grep mariadb) chrony&#39;</span>
</code></pre></div><h4 id="3配置">3.配置</h4>
<ul>
<li>禁用Linux THP（Transparent HugePages）服务</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;if test -f /sys/kernel/mm/transparent_hugepage/enabled;then echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled;fi;if test -f /sys/kernel/mm/transparent_hugepage/defrag; then echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag;fi&#39;</span>
</code></pre></div><ul>
<li>设置开机启动禁用THP服务</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;echo &#34;if test -f /sys/kernel/mm/transparent_hugepage/enabled;then echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled;fi;if test -f /sys/kernel/mm/transparent_hugepage/defrag; then echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag;fi&#34;&gt;&gt; /etc/rc.local&#39;</span>
</code></pre></div><ul>
<li>设置swap</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;echo vm.swappiness = 0 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p &amp;&amp; swapoff -a&#39;</span>
</code></pre></div><h4 id="3安装配置ntp服务">3.安装配置ntp服务</h4>
<ul>
<li>安装</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;yum install -y ntp&#39;</span>
</code></pre></div><ul>
<li>配置ntp</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /etc/ntp.conf 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">server time.pool.aliyun.com
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m copy -a <span style="color:#e6db74">&#39;src=/etc/ntp.conf dest=/etc/ntp.conf&#39;</span>
</code></pre></div><ul>
<li>启动ntp服务</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m systemd -a <span style="color:#e6db74">&#39;name=ntpd state=started enabled=true&#39;</span>
</code></pre></div><ul>
<li>检查ntp服务</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;ntpstat&#39;</span>
</code></pre></div><h4 id="4mysql安装">4.MySQL安装</h4>
<ul>
<li>配置MySQL源</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;rpm -ivh https://repo.mysql.com//mysql80-community-release-el7-3.noarch.rpm &amp;&amp; yum makecache&#39;</span>
</code></pre></div><ul>
<li>MySQL节点修改为源为5.7版本</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /etc/yum.repos.d/mysql-community.repo 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Enable to use MySQL 5.7</span>
<span style="color:#f92672">[</span>mysql57-community<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>MySQL 5.7 Community Server
baseurl<span style="color:#f92672">=</span>http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgkey<span style="color:#f92672">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql

<span style="color:#f92672">[</span>mysql80-community<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>MySQL 8.0 Community Server
baseurl<span style="color:#f92672">=</span>http://repo.mysql.com/yum/mysql-8.0-community/el/7/$basearch/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgkey<span style="color:#f92672">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql
</code></pre></div><ul>
<li>安装MySQL客户端、JDBC驱动</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;yum install -y mysql&#39;</span>
ansible cdh -m shell -a <span style="color:#e6db74">&#39;yum install -y java-headless&#39;</span>
ansible cdh -m shell -a <span style="color:#e6db74">&#39;rpm -ivh https://mysql.com/Downloads/Connector-J/mysql-connector-java-8.0.18-1.el7.noarch.rpm&#39;</span>
</code></pre></div><ul>
<li>安装MySQL-Server5.7</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install mysql-server
</code></pre></div><ul>
<li>修改MySQL配置</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /data/mysql <span style="color:#f92672">&amp;&amp;</span> chown -R mysql. /data/mysql
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /etc/my.cnf
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span>
datadir<span style="color:#f92672">=</span>/data/mysql/data
socket<span style="color:#f92672">=</span>/var/lib/mysql/mysql.sock
transaction-isolation <span style="color:#f92672">=</span> READ-COMMITTED
<span style="color:#75715e"># Disabling symbolic-links is recommended to prevent assorted security risks;</span>
<span style="color:#75715e"># to do so, uncomment this line:</span>
symbolic-links <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

key_buffer_size <span style="color:#f92672">=</span> 32M
max_allowed_packet <span style="color:#f92672">=</span> 32M
thread_stack <span style="color:#f92672">=</span> 256K
thread_cache_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>
query_cache_limit <span style="color:#f92672">=</span> 8M
query_cache_size <span style="color:#f92672">=</span> 64M
query_cache_type <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>

max_connections <span style="color:#f92672">=</span> <span style="color:#ae81ff">550</span>
<span style="color:#75715e">#expire_logs_days = 10</span>
<span style="color:#75715e">#max_binlog_size = 100M</span>

<span style="color:#75715e">#log_bin should be on a disk with enough free space.</span>
<span style="color:#75715e">#Replace &#39;/var/lib/mysql/mysql_binary_log&#39; with an appropriate path for your</span>
<span style="color:#75715e">#system and chown the specified folder to the mysql user.</span>
log_bin<span style="color:#f92672">=</span>/data/mysql/mysql_binary_log

<span style="color:#75715e">#In later versions of MySQL, if you enable the binary log and do not set</span>
<span style="color:#75715e">#a server_id, MySQL will not start. The server_id must be unique within</span>
<span style="color:#75715e">#the replicating group.</span>
server_id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>

binlog_format <span style="color:#f92672">=</span> row

read_buffer_size <span style="color:#f92672">=</span> 2M
read_rnd_buffer_size <span style="color:#f92672">=</span> 16M
sort_buffer_size <span style="color:#f92672">=</span> 8M
join_buffer_size <span style="color:#f92672">=</span> 8M

<span style="color:#75715e"># InnoDB settings</span>
innodb_file_per_table <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
innodb_flush_log_at_trx_commit  <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
innodb_log_buffer_size <span style="color:#f92672">=</span> 64M
innodb_buffer_pool_size <span style="color:#f92672">=</span> 4G
innodb_thread_concurrency <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
innodb_flush_method <span style="color:#f92672">=</span> O_DIRECT
innodb_log_file_size <span style="color:#f92672">=</span> 512M

<span style="color:#f92672">[</span>mysqld_safe<span style="color:#f92672">]</span>
log-error<span style="color:#f92672">=</span>/var/log/mysqld.log
pid-file<span style="color:#f92672">=</span>/var/run/mysqld/mysqld.pid

sql_mode<span style="color:#f92672">=</span>STRICT_ALL_TABLES
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl start mysqld
systemctl enable mysqld
</code></pre></div><ul>
<li>修改root密码</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># cat /var/log/mysqld.log |grep password</span>
2019-11-04T12:13:53.053832Z <span style="color:#ae81ff">1</span> <span style="color:#f92672">[</span>Note<span style="color:#f92672">]</span> A temporary password is generated <span style="color:#66d9ef">for</span> root@localhost: ZsxL0gkqdU:;

mysqladmin -u root -p<span style="color:#e6db74">&#39;jE%IxE;(=3hF&#39;</span> password Belle@2020

</code></pre></div><ul>
<li>忘记密码</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /etc/my.cnf
 
<span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span>
skip-grant-tables
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl restart mysqld
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysql
mysql&gt; use mysql;
mysql&gt; UPDATE user SET authentication_string<span style="color:#f92672">=</span>PASSWORD<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Belle@019&#39;</span><span style="color:#f92672">)</span> where USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root&#39;</span>;  
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; exit
</code></pre></div><p>移除<code>skip-grant-tables</code>后重启MySQL</p>
<ul>
<li>进入MySQL后需要重新设置密码</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">USER</span> <span style="color:#66d9ef">USER</span>() IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;Belle@019&#39;</span>;
</code></pre></div><ul>
<li>修改密码策略</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> VARIABLES <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#34;%password%&#34;</span>;
<span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> validate_password_policy<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> validate_password_policy<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">set</span> <span style="color:#66d9ef">global</span> validate_password_length<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</code></pre></div><h4 id="5安装系统依赖">5.安装系统依赖</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;yum install -y mysql-devel python-devel cyrus-sasl-plain  cyrus-sasl-devel  cyrus-sasl-gssapi &amp;&amp; pip install psycopg2==2.7.5 --ignore-installed&#39;</span>
</code></pre></div><h4 id="6配置cdh-yum源">6.配置CDH yum源</h4>
<ul>
<li>配置</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">vim /etc/yum.repos.d/cloudera-repo.repo

<span style="color:#f92672">[</span>cloudera-repo<span style="color:#f92672">]</span>
name<span style="color:#f92672">=</span>cloudera-repo
baseurl<span style="color:#f92672">=</span>http://repo.belle.lan:8900/CDH6.0.0/cm/cm6/6.0.0/redhat7/yum/
enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</code></pre></div><ul>
<li>分发</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m copy -a <span style="color:#e6db74">&#39;src=/etc/yum.repos.d/cloudera-repo.repo dest=/etc/yum.repos.d/cloudera-repo.repo&#39;</span>
</code></pre></div><ul>
<li>安装JDK（此时可以不安装，安装向导再安装）</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;yum install -y oracle-j2sdk1.8&#39;</span>
</code></pre></div><h4 id="7安装cdh">7.安装CDH</h4>
<ul>
<li>安装CM-Agent</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible cdh -m shell -a <span style="color:#e6db74">&#39;yum install -y cloudera-manager-daemons cloudera-manager-agent&#39;</span> 
</code></pre></div><ul>
<li>安装CM Server</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install -y cloudera-manager-server
</code></pre></div><ul>
<li>初始化SCM数据库</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/opt/cloudera/cm/schema/scm_prepare_database.sh mysql -uroot -pBelle@2020 scm scm scm@2020
</code></pre></div><ul>
<li>启动CM</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl start cloudera-scm-server
</code></pre></div><ul>
<li>查看启动日志</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log 

INFO WebServerImpl:org.eclipse.jetty.server.Server: Started @147388ms
INFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server.
</code></pre></div><ul>
<li>访问CM</li>
</ul>
<p>http://cm:7180</p>
<ul>
<li>配置软件仓库</li>
<li>安装JDK</li>
<li>安装CDH</li>
<li>创建MySQL库</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> metastore <span style="color:#66d9ef">DEFAULT</span> CHARACTER <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">COLLATE</span> utf8_general_ci;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> metastore.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;hive&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;hive@2020&#39;</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> hue <span style="color:#66d9ef">DEFAULT</span> CHARACTER <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">COLLATE</span> utf8_general_ci;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> hue.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;hue&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;hue@2020&#39;</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> sentry <span style="color:#66d9ef">DEFAULT</span> CHARACTER <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">COLLATE</span> utf8_general_ci;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> sentry.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;sentry&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;sentry@2020&#39;</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> oozie <span style="color:#66d9ef">DEFAULT</span> CHARACTER <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">COLLATE</span> utf8_general_ci;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> oozie.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;oozie&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;oozie@2020&#39;</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> amon <span style="color:#66d9ef">DEFAULT</span> CHARACTER <span style="color:#66d9ef">SET</span> utf8 <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">COLLATE</span> utf8_general_ci;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">ON</span> amon.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;amon&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;amon@2020&#39;</span>;
</code></pre></div><h4 id="8ldap客户端配置">8.LDAP客户端配置</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible new -m shell -a <span style="color:#e6db74">&#34;yum -y install openldap-clients sssd authconfig nss-pam-ldapd &amp;&amp; echo &#39;URI ldap://ldap.cdh.prd.bjds.belle.lan&#39; &gt;&gt; /etc/openldap/ldap.conf &amp;&amp;  echo &#39;BASE dc=belle,dc=com&#39; &gt;&gt; /etc/openldap/ldap.conf &amp;&amp; authconfig --enablesssd --enablesssdauth  --enableldap --enableldapauth --disableforcelegacy --disableldaptls --disablekrb5 --ldapserver ldap://ldap.cdh.prd.bjds.belle.lan --ldapbasedn &#39;dc=belle,dc=com&#39; --enablemkhomedir --update &amp;&amp; chmod 600 /etc/sssd/sssd.conf &amp;&amp; systemctl start sssd &amp;&amp; systemctl enable sssd&#34;</span> 
</code></pre></div><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://example.org/" >
    &copy;  My New Hugo Site 2021 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
