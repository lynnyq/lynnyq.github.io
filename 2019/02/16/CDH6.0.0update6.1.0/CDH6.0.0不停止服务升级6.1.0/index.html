<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="hello">










<meta name="description" content="CDH6.0.0升级6.1.0步骤官方文档 参考文档 [TOC] 1.CM升级1.1.升级概述 升级CDH集群，可以通过Cloudera Manager使用Cloudera parcels升级整个集群，也可以在所有群集主机使用基于RPM包的命令手动安装软件，然后Cloudera Manager完成服务升级。 可以不同时升级Cloudera Manager和CDH，但Cloudera Manager">
<meta property="og:type" content="article">
<meta property="og:title" content="lynnyq">
<meta property="og:url" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/index.html">
<meta property="og:site_name" content="lynnyq">
<meta property="og:description" content="CDH6.0.0升级6.1.0步骤官方文档 参考文档 [TOC] 1.CM升级1.1.升级概述 升级CDH集群，可以通过Cloudera Manager使用Cloudera parcels升级整个集群，也可以在所有群集主机使用基于RPM包的命令手动安装软件，然后Cloudera Manager完成服务升级。 可以不同时升级Cloudera Manager和CDH，但Cloudera Manager">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm01.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm02.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm03.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm04.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm05.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm06.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm07.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm08.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm09.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm10.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm11.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm12.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm13.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm14.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm15.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm16.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm17.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm18.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm19.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm21.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm22.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm23.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm24.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm25.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm26.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm27.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm28.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm29.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm30.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm31.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm32.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm33.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm34.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm35.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm36.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm37.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm38.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm39.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm40.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm41.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm42.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm43.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm44.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh03.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh04.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh05.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh06.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh01.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh02.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh07.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh08.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh09.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh10.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh11.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh13.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh12.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh14.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh18.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh17.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh19.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh20.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh21.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh22.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh23.png">
<meta property="og:image" content="http://yoursite.com/Users/yangqian/Desktop/cdh24.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh25.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/26.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh27.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh28.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh29.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh30.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh31.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/old.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/new.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh33.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh34.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh35.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh01.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cdh02.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb01.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb02.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb02-1.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb03.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb04.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb05.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb06.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb07.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb08.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb09.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb10.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb11.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb12.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb13.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb17.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb18.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb19.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb20.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb21.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb22.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb23.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/old.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb14.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb15.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/rb16.png">
<meta property="og:updated_time" content="2019-02-17T04:32:49.691Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lynnyq">
<meta name="twitter:description" content="CDH6.0.0升级6.1.0步骤官方文档 参考文档 [TOC] 1.CM升级1.1.升级概述 升级CDH集群，可以通过Cloudera Manager使用Cloudera parcels升级整个集群，也可以在所有群集主机使用基于RPM包的命令手动安装软件，然后Cloudera Manager完成服务升级。 可以不同时升级Cloudera Manager和CDH，但Cloudera Manager">
<meta name="twitter:image" content="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/images/cm01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/">





  <title> | lynnyq</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/lynnyq" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lynnyq</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lynnyq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lynnyq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline"></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-16T23:32:13+08:00">
                2019-02-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="CDH6-0-0升级6-1-0步骤"><a href="#CDH6-0-0升级6-1-0步骤" class="headerlink" title="CDH6.0.0升级6.1.0步骤"></a>CDH6.0.0升级6.1.0步骤</h2><p><a href="https://www.cloudera.com/documentation/enterprise/upgrade/topics/ug_overview.html" target="_blank" rel="noopener">官方文档</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1077573" target="_blank" rel="noopener">参考文档</a></p>
<p>[TOC]</p>
<h3 id="1-CM升级"><a href="#1-CM升级" class="headerlink" title="1.CM升级"></a>1.CM升级</h3><h4 id="1-1-升级概述"><a href="#1-1-升级概述" class="headerlink" title="1.1.升级概述"></a>1.1.升级概述</h4><p><img src="images/cm01.png" alt></p>
<p>升级CDH集群，可以通过Cloudera Manager使用Cloudera parcels升级整个集群，也可以在所有群集主机使用基于RPM包的命令手动安装软件，然后Cloudera Manager完成服务升级。</p>
<p>可以不同时升级Cloudera Manager和CDH，但Cloudera Manager和CDH的版本必须兼容，Cloudera Manager的主要+次要版本等于或高于CDH的主要+次要版本。</p>
<h4 id="1-2-下载文件"><a href="#1-2-下载文件" class="headerlink" title="1.2.下载文件"></a>1.2.下载文件</h4><p><a href="https://archive.cloudera.com/cm6/" target="_blank" rel="noopener">CM6.1.0</a></p>
<p><a href="http://10.240.9.132:8900/CDH6.1.0/" target="_blank" rel="noopener">北京IDC内网地址</a></p>
<h4 id="1-3-备份"><a href="#1-3-备份" class="headerlink" title="1.3.备份"></a>1.3.备份</h4><p><a href="https://www.cloudera.com/documentation/enterprise/upgrade/topics/ug_cm_upgrade_before.html" target="_blank" rel="noopener">官方文档</a></p>
<h5 id="1-3-1-收集信息"><a href="#1-3-1-收集信息" class="headerlink" title="1.3.1.收集信息"></a>1.3.1.收集信息</h5><ul>
<li>操作系统信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure>
<ul>
<li>查看数据库配置信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/cloudera-scm-server/db.properties</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/cloudera-scm-server/db.properties</span></span><br><span class="line"><span class="comment"># Auto-generated by scm_prepare_database.sh on Thu Dec  6 18:42:08 CST 2018</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For information describing how to configure the Cloudera Manager Server</span></span><br><span class="line"><span class="comment"># to connect to databases, see the "Cloudera Manager Installation Guide."</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">com.cloudera.cmf.db.type=mysql</span><br><span class="line">com.cloudera.cmf.db.host=localhost</span><br><span class="line">com.cloudera.cmf.db.name=scm</span><br><span class="line">com.cloudera.cmf.db.user=scm</span><br><span class="line">com.cloudera.cmf.db.setupType=EXTERNAL</span><br><span class="line">com.cloudera.cmf.db.password=scm</span><br></pre></td></tr></table></figure>
<h5 id="1-3-2-备份CM-Agent"><a href="#1-3-2-备份CM-Agent" class="headerlink" title="1.3.2.备份CM Agent"></a>1.3.2.备份CM Agent</h5><ul>
<li>创建备份目录 （在所有主机上执行）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CM_BACKUP_DIR=<span class="string">"`date +%F`-CM6.0.0"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CM_BACKUP_DIR</span></span><br><span class="line">mkdir backup</span><br><span class="line"><span class="built_in">cd</span> backup</span><br><span class="line">mkdir -p <span class="variable">$CM_BACKUP_DIR</span></span><br></pre></td></tr></table></figure>
<ul>
<li>备份CM Agent当前运行状态（在所有主机上执行）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cf <span class="variable">$CM_BACKUP_DIR</span>/cloudera-scm-agent.tar --exclude=*.sock /etc/cloudera-scm-agent /etc/default/cloudera-scm-agent /var/run/cloudera-scm-agent /var/lib/cloudera-scm-agent</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The tar commands in the steps below may return the following message. It is safe to ignore thismessage:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; tar: Removing leading `/&apos; from member names</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="images/cm02.png" alt></p>
<p><img src="images/cm03.png" alt></p>
<ul>
<li>备份yum源（在所有主机上执行）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cf <span class="variable">$CM_BACKUP_DIR</span>/repository.tar /etc/yum.repos.d</span><br></pre></td></tr></table></figure>
<p><img src="images/cm04.png" alt></p>
<h5 id="1-3-3-备份Cloudera-Management-Service"><a href="#1-3-3-备份Cloudera-Management-Service" class="headerlink" title="1.3.3.备份Cloudera Management Service"></a>1.3.3.备份Cloudera Management Service</h5><ul>
<li>在Service Monitor role 机器上执行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp -rp /var/lib/cloudera-service-monitor /var/lib/cloudera-service-monitor-`date +%F`-CM6.0.0</span><br><span class="line"><span class="comment">## 如果自定义了目录需要修改为自定义的目录</span></span><br></pre></td></tr></table></figure>
<p><img src="images/cm05.png" alt></p>
<ul>
<li>在Host Monitor role机器上执行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rp /var/lib/cloudera-host-monitor /var/lib/cloudera-host-monitor-`date +%F`-CM6.0.0</span><br></pre></td></tr></table></figure>
<p><img src="images/cm06.png" alt></p>
<ul>
<li>在 Event Server role机器上执行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rp /var/lib/cloudera-scm-eventserver /var/lib/cloudera-scm-eventserver-`date +%F`-CM6.0.0</span><br></pre></td></tr></table></figure>
<p><img src="images/cm07.png" alt></p>
<h5 id="1-3-4-停止CM相关服务"><a href="#1-3-4-停止CM相关服务" class="headerlink" title="1.3.4.停止CM相关服务"></a>1.3.4.停止CM相关服务</h5><ul>
<li>停止Cloudera Management Service</li>
</ul>
<p><strong>登录CM管理界面操作</strong></p>
<p><img src="images/cm08.png" alt></p>
<p><img src="images/cm09.png" alt></p>
<ul>
<li>停止Cloudera Manager Server （CM机器上执行）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop cloudera-scm-server</span><br></pre></td></tr></table></figure>
<p><img src="images/cm10.png" alt></p>
<h5 id="1-3-5-备份CM数据库（mysql机器上执行）"><a href="#1-3-5-备份CM数据库（mysql机器上执行）" class="headerlink" title="1.3.5.备份CM数据库（mysql机器上执行）"></a>1.3.5.备份CM数据库（mysql机器上执行）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --databases scm --host=localhost --port=3306 -u scm -p &gt; <span class="variable">$HOME</span>/scm-backup-`date +%F`-CM6.0.0.sql</span><br></pre></td></tr></table></figure>
<p><img src="images/cm11.png" alt></p>
<h5 id="1-3-6-备份CM其他相关服务的数据库（mysql机器上执行）"><a href="#1-3-6-备份CM其他相关服务的数据库（mysql机器上执行）" class="headerlink" title="1.3.6.备份CM其他相关服务的数据库（mysql机器上执行）"></a>1.3.6.备份CM其他相关服务的数据库（mysql机器上执行）</h5><p><img src="images/cm12.png" alt></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --databases am --host=localhost --port=3306 -u am -p &gt; <span class="variable">$HOME</span>/am-backup-`date +%F`-CM6.0.0.sql</span><br></pre></td></tr></table></figure>
<p><img src="images/cm13.png" alt></p>
<h5 id="1-3-7-备份Cloudera-Manager-Server（CM机器上执行）"><a href="#1-3-7-备份Cloudera-Manager-Server（CM机器上执行）" class="headerlink" title="1.3.7.备份Cloudera Manager Server（CM机器上执行）"></a>1.3.7.备份Cloudera Manager Server（CM机器上执行）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cf <span class="variable">$CM_BACKUP_DIR</span>/cloudera-scm-server.tar /etc/cloudera-scm-server /etc/default/cloudera-scm-server</span><br></pre></td></tr></table></figure>
<p><img src="images/cm14.png" alt></p>
<h4 id="1-4-升级Cloudera-Manager-Server"><a href="#1-4-升级Cloudera-Manager-Server" class="headerlink" title="1.4.升级Cloudera Manager Server"></a>1.4.升级Cloudera Manager Server</h4><ul>
<li>删除yum源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /etc/yum.repos.d/cloudera*manager.repo*</span><br></pre></td></tr></table></figure>
<p><img src="images/cm15.png" alt></p>
<ul>
<li>添加新的yum源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/cloudera-manager.repo</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[cloudera-repo]</span><br><span class="line">name=cloudera-repo</span><br><span class="line">baseurl=http://10.240.9.132:8900/CDH6.1.0/cm/cm6/6.1.0/redhat7/yum/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean  all</span><br><span class="line">rm -rf /var/cache/yum</span><br><span class="line">yum  repolist</span><br></pre></td></tr></table></figure>
<p><img src="images/cm16.png" alt></p>
<ul>
<li>停止cloudera-scm-agent服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop cloudera-scm-agent</span><br></pre></td></tr></table></figure>
<ul>
<li>升级CM</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum upgrade cloudera-manager-server cloudera-manager-daemons cloudera-manager-agent</span><br></pre></td></tr></table></figure>
<p><strong>如果弹出更新配置文件选项选择N</strong></p>
<blockquote>
<p>You might be prompted about your configuration file version:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; Configuration file &apos;/etc/cloudera-scm-agent/config.ini&apos;</span><br><span class="line">&gt; ==&gt; Modified (by you or by a script) since installation.</span><br><span class="line">&gt; ==&gt; Package distributor has shipped an updated version.</span><br><span class="line">&gt; What would you like to do about it ? Your options are:</span><br><span class="line">&gt; Y or I : install the package maintainer&apos;s version</span><br><span class="line">&gt; N or O : keep your currently-installed version</span><br><span class="line">&gt; D : show the differences between the versions</span><br><span class="line">&gt; Z : start a shell to examine the situation</span><br><span class="line">&gt; The default action is to keep your current version.</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>You may receive a similar prompt for /etc/cloudera-scm-server/db.properties. Answer <strong>N</strong> to both prompts.</p>
<p>You may be prompted to accept the GPG key. Answer <strong>y</strong>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; Retrieving key from https://archive.cloudera.com/.../cm/RPM-GPG-KEY-cloudera</span><br><span class="line">&gt; Importing GPG key ...</span><br><span class="line">&gt;  Userid     : &quot;Yum Maintainer &lt;webmaster@cloudera.com&gt;&quot;</span><br><span class="line">&gt;  Fingerprint: ...</span><br><span class="line">&gt;  From       : https://archive.cloudera.com/.../RPM-GPG-KEY-cloudera</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="images/cm17.png" alt></p>
<ul>
<li>检查安装的包是否正确</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa <span class="string">'cloudera-manager-*'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cloudera-manager-server-6.1.0-769885.el7.x86_64</span><br><span class="line">cloudera-manager-daemons-6.1.0-769885.el7.x86_64</span><br><span class="line">cloudera-manager-agent-6.1.0-769885.el7.x86_64</span><br></pre></td></tr></table></figure>
<p><img src="images/cm18.png" alt></p>
<ul>
<li>启动服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start cloudera-scm-agent</span><br><span class="line">systemctl start cloudera-scm-server</span><br></pre></td></tr></table></figure>
<ul>
<li>检查日志</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/<span class="built_in">log</span>/cloudera-scm-server/cloudera-scm-server.log</span><br><span class="line">tail -f /var/<span class="built_in">log</span>/cloudera-scm-agent/cloudera-scm-agent.log</span><br></pre></td></tr></table></figure>
<p><img src="images/cm19.png" alt></p>
<ul>
<li>登录CM管理平台<a href="http://10.240.9.132:7180自动运行升级向导" target="_blank" rel="noopener">http://10.240.9.132:7180自动运行升级向导</a></li>
</ul>
<p><img src="images/cm21.png" alt></p>
<p><img src="images/cm22.png" alt></p>
<p>输入升级源</p>
<p><a href="http://10.240.9.132:8900/CDH6.1.0/cm/cm6/6.1.0/" target="_blank" rel="noopener">http://10.240.9.132:8900/CDH6.1.0/cm/cm6/6.1.0/</a></p>
<p><img src="images/cm23.png" alt></p>
<p><img src="images/cm24.png" alt></p>
<p><img src="images/cm25.png" alt></p>
<p><img src="images/cm26.png" alt></p>
<p><img src="images/cm27.png" alt></p>
<p><img src="images/cm28.png" alt></p>
<p><img src="images/cm29.png" alt></p>
<p><img src="images/cm30.png" alt></p>
<p><img src="images/cm31.png" alt></p>
<p><img src="images/cm32.png" alt></p>
<p><img src="images/cm33.png" alt></p>
<p>Cloudera Manager在升级后报告过时的配置，请重新启动集群服务并重新部署客户端配置</p>
<p><img src="images/cm34.png" alt></p>
<p><img src="images/cm35.png" alt></p>
<p><img src="images/cm36.png" alt></p>
<p><img src="images/cm37.png" alt></p>
<ul>
<li><p>检查升级结果</p>
<p><strong>查看Cloudera Manager版本</strong></p>
</li>
</ul>
<p><img src="images/cm38.png" alt></p>
<p><img src="images/cm39.png" alt></p>
<p><strong>验证Agent是否向Cloudera Manager发送心跳</strong></p>
<p><img src="images/cm40.png" alt></p>
<p><strong>检查所有主机</strong></p>
<p><img src="images/cm41.png" alt></p>
<p><img src="images/cm42.png" alt></p>
<p><strong>查看检查结果</strong></p>
<p><img src="images/cm43.png" alt></p>
<p><strong>检查集群历史监控数据</strong></p>
<p><img src="images/cm44.png" alt></p>
<p><strong>至此CM升级成功。</strong></p>
<h3 id="2-CDH升级"><a href="#2-CDH升级" class="headerlink" title="2.CDH升级"></a>2.CDH升级</h3><p><a href="https://www.cloudera.com/documentation/enterprise/upgrade/topics/ug_cdh_upgrade_before.html" target="_blank" rel="noopener">官方文档</a></p>
<h4 id="2-1-准备安装包"><a href="#2-1-准备安装包" class="headerlink" title="2.1.准备安装包"></a>2.1.准备安装包</h4><p><a href="https://archive.cloudera.com/cdh6/6.1.0/" target="_blank" rel="noopener">官方CDH6.1.0下载地址</a></p>
<p><a href="http://10.240.9.132:8900/CDH6.1.0/cdh/" target="_blank" rel="noopener">北京IDC内网地址</a></p>
<h4 id="2-2-服务检查"><a href="#2-2-服务检查" class="headerlink" title="2.2.服务检查"></a>2.2.服务检查</h4><ul>
<li>HDFS检查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录任意一个节点，检查HDFS是否有错误，有错误修改后继续</span></span><br><span class="line">sudo -u hdfs hdfs fsck / -includeSnapshots</span><br><span class="line">sudo -u hdfs hdfs dfsadmin -report</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh03.png" alt><img src="images/cdh04.png" alt></p>
<ul>
<li>HBase检查</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登录任意一个DataNode节点，执行如下命令检查，有错误的话，修正错误后继续</span></span><br><span class="line">sudo -u hdfs hbase hbck</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh05.png" alt></p>
<ul>
<li>KUDU检查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行如下命令检查，有错误的话，修正错误后继续</span></span><br><span class="line"><span class="comment"># kudu kudu cluster ksck kudu_master_host1,ksck kudu_master_host2</span></span><br><span class="line">sudo -u kudu kudu cluster ksck bjds-bi-odp-prd-10-240-9-132-belle.lan</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh06.png" alt></p>
<h4 id="2-3-进入维护模式"><a href="#2-3-进入维护模式" class="headerlink" title="2.3.进入维护模式"></a>2.3.进入维护模式</h4><p>1.CM首选选择进入维护模式</p>
<p>2.升级预处理</p>
<ul>
<li><p>Ensure that new applications, such as MapReduce or Spark applications, will not be submitted to the cluster until the upgrade is complete.</p>
</li>
<li><p>In the Cloudera Manager Admin Console, navigate to the YARN service for the cluster you are upgrading.</p>
</li>
<li><p>On the <strong>Instances</strong> tab, select all the <strong>NodeManager</strong> roles. This can be done by filtering for the roles under <strong>Role Type</strong>.</p>
</li>
<li><p>Click Actions for Selected (number) &gt; Decommission.<br>If the cluster runs CDH 5.9 or higher and is managed by Cloudera Manager 5.9 or higher, and you configured graceful decommission, the countdown for the timeout starts.</p>
<p>A Graceful Decommission provides a timeout before starting the decommission process. The timeout creates a window of time to drain already running workloads from the system and allow them to run to completion. Search for the Node Manager Graceful Decommission Timeout field on the Configuration tab for the YARN service, and set the property to a value greater than 0 to create a timeout.</p>
</li>
<li><p>Wait for the decommissioning to complete. The NodeManager State is Stopped and the Commission State is Decommissioned when decommissioning completes for each NodeManager.</p>
</li>
<li><p>With all the NodeManagers still selected, click <strong>Actions for Selected (number)</strong> &gt; <strong>Recommission</strong>.</p>
</li>
</ul>
<p><strong>Important:</strong> Do not start the NodeManagers.</p>
<p><img src="images/cdh01.png" alt></p>
<p><img src="images/cdh02.png" alt></p>
<h4 id="2-4-备份数据库"><a href="#2-4-备份数据库" class="headerlink" title="2.4.备份数据库"></a>2.4.备份数据库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份hue</span></span><br><span class="line">mysqldump --databases hue --host=localhost --port=3306 -u hue -p &gt; hue-backup-`date +%F`-CDH6.0.0.sql</span><br><span class="line"><span class="comment"># 备份hive元数据</span></span><br><span class="line">mysqldump --databases metastore --host=localhost --port=3306 -u hive -p &gt; metastore-backup-`date +%F`-CDH6.0.0.sql</span><br><span class="line"><span class="comment"># 备份oozie</span></span><br><span class="line">mysqldump --databases oozie --host=localhost --port=3306 -u oozie -p &gt; oozie-backup-`date +%F`-CDH6.0.0.sql</span><br><span class="line"><span class="comment"># 备份sentry</span></span><br><span class="line">mysqldump --databases sentry --host=localhost --port=3306 -u sentry -p &gt; sentry-backup-`date +%F`-CDH6.0.0.sql</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh07.png" alt></p>
<p><img src="images/cdh08.png" alt></p>
<h4 id="2-5-备份ZooKeeper-所有节点"><a href="#2-5-备份ZooKeeper-所有节点" class="headerlink" title="2.5.备份ZooKeeper(所有节点)"></a>2.5.备份ZooKeeper(所有节点)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rp /var/lib/zookeeper/ /var/lib/zookeeper-backup-`date +%F`CM6.1.0-CDH6.0.0</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh09.png" alt></p>
<h4 id="2-6-备份数据"><a href="#2-6-备份数据" class="headerlink" title="2.6.备份数据"></a>2.6.备份数据</h4><ul>
<li>启用了HA的HDFS需要登录<strong>所有的JournalNode节点备份</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rp /data/dfs/jn /data/dfs/jn-CM6.1.0-CDH6.0.0</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh10.png" alt></p>
<ul>
<li>备份<strong>所有的NameNode节点</strong>运行状态</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/hadoop/conf.rollback.namenode</span><br><span class="line"><span class="built_in">cd</span> /var/run/cloudera-scm-agent/process/ &amp;&amp; <span class="built_in">cd</span> `ls -t1 | grep -e <span class="string">"-NAMENODE\$"</span> | head -1`</span><br><span class="line">cp -rp * /etc/hadoop/conf.rollback.namenode/</span><br><span class="line">rm -rf /etc/hadoop/conf.rollback.namenode/log4j.properties</span><br><span class="line">cp -rp /etc/hadoop/conf.cloudera.hdfs/log4j.properties /etc/hadoop/conf.rollback.namenode/</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh11.png" alt></p>
<ul>
<li>备份NameNode的元数据（所有namenode主机）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czvf <span class="variable">$CM_BACKUP_DIR</span>/nn_backup.tar.gz  /data/dfs/nn/</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh13.png" alt></p>
<ul>
<li>备份<strong>所有的DataNode</strong>运行状态（所有运行DataNode主机）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/hadoop/conf.rollback.datanode/</span><br><span class="line"><span class="built_in">cd</span> /var/run/cloudera-scm-agent/process/ &amp;&amp; <span class="built_in">cd</span> `ls -t1 | grep -e <span class="string">"-DATANODE\$"</span> | head -1`</span><br><span class="line">cp -rp * /etc/hadoop/conf.rollback.datanode/</span><br><span class="line">rm -rf /etc/hadoop/conf.rollback.datanode/log4j.properties</span><br><span class="line">cp -rp /etc/hadoop/conf.cloudera.hdfs/log4j.properties /etc/hadoop/conf.rollback.datanode/</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh12.png" alt></p>
<ul>
<li>备份Hue，所有的Hue Server主机</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在所有的Hue Server角色上运行</span></span><br><span class="line">mkdir -p /opt/cloudera/parcels_backup</span><br><span class="line">cp -rp /opt/cloudera/parcels/CDH/lib/hue/app.reg /opt/cloudera/parcels_backup/app.reg-CM6.1.0-CDH6.0.0</span><br></pre></td></tr></table></figure>
<h4 id="2-7-向集群中添加新版的CDH存储库"><a href="#2-7-向集群中添加新版的CDH存储库" class="headerlink" title="2.7.向集群中添加新版的CDH存储库"></a>2.7.向集群中添加新版的CDH存储库</h4><p><img src="images/cdh14.png" alt></p>
<p><img src="images/cdh18.png" alt></p>
<p><a href="http://10.240.9.132:8900/CDH6.1.0/cdh/" target="_blank" rel="noopener">http://10.240.9.132:8900/CDH6.1.0/cdh/</a></p>
<p><img src="images/cdh17.png" alt></p>
<h4 id="2-8-运行升级向导开始升级"><a href="#2-8-运行升级向导开始升级" class="headerlink" title="2.8.运行升级向导开始升级"></a>2.8.运行升级向导开始升级</h4><p><img src="images/cdh19.png" alt></p>
<p><img src="images/cdh20.png" alt></p>
<p><img src="images/cdh21.png" alt></p>
<p><img src="images/cdh22.png" alt></p>
<p><img src="images/cdh23.png" alt></p>
<p><img src="/Users/yangqian/Desktop/cdh24.png" alt></p>
<p><img src="images/cdh25.png" alt></p>
<p><img src="images/26.png" alt></p>
<p><img src="images/cdh27.png" alt></p>
<p><img src="images/cdh28.png" alt></p>
<h4 id="2-9-功能验证"><a href="#2-9-功能验证" class="headerlink" title="2.9.功能验证"></a>2.9.功能验证</h4><ul>
<li>运行一个MR任务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u hdfs hadoop jar  /opt/cloudera/parcels/CDH/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar  pi 10 100</span><br></pre></td></tr></table></figure>
<p><img src="images/cdh29.png" alt></p>
<p><img src="images/cdh30.png" alt></p>
<p><img src="images/cdh31.png" alt></p>
<ul>
<li>Hue测试</li>
</ul>
<p>检查原有数据</p>
<p>CDH6.0.0的数据</p>
<p><img src="images/old.png" alt></p>
<p>升级CDH6.1.0后的数据</p>
<p><img src="images/new.png" alt></p>
<p>创建数据库</p>
<p><img src="images/cdh33.png" alt></p>
<p>创建表和插入数据</p>
<p><img src="images/cdh34.png" alt></p>
<h4 id="2-10-最终化元数据升级"><a href="#2-10-最终化元数据升级" class="headerlink" title="2.10.最终化元数据升级"></a>2.10.最终化元数据升级</h4><p><strong>在最终化元数据之前，进行几天甚至几周的运行观察集群是否正常，在发现所有任务都没有任何异常情况后，再进行最终化元数据操作。一旦进行最终化元数据之后，就不能回滚到老的版本了，除非有数据备份。对NameNode的主备节点都执行最终化元数据升级操作：</strong></p>
<p><img src="images/cdh35.png" alt></p>
<h3 id="3-CDH回滚"><a href="#3-CDH回滚" class="headerlink" title="3.CDH回滚"></a>3.CDH回滚</h3><p><a href="https://www.cloudera.com/documentation/enterprise/upgrade/topics/install_rollback.html" target="_blank" rel="noopener">官方文档</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1078827" target="_blank" rel="noopener">参考文档</a></p>
<h4 id="3-1-回滚限制"><a href="#3-1-回滚限制" class="headerlink" title="3.1.回滚限制"></a>3.1.回滚限制</h4><ul>
<li><strong>HDFS</strong> - 不能对进行过<strong>最终化元数据升级（2.10步骤）</strong>的HDFS集群进行回滚。</li>
<li><strong>集群升级后的配置变化将不会被保留</strong> - 包括升级后的角色、服务的变更。Cloudera 的建议是最终化元数据升级后再进行集群角色和服务的变更。</li>
<li><strong>HBase</strong> – If your cluster is configured to use HBase replication, data written to HBase after the upgrade might not be replicated to peers when you start your rollback. This topic does not describe how to determine which, if any, peers have the replicated data and how to roll back that data. For more information about HBase replication, see <a href="https://www.cloudera.com/documentation/enterprise/upgrade/topics/cdh_bdr_hbase_replication.html#topic_20_11" target="_blank" rel="noopener">HBase Replication</a>.</li>
<li><strong>Sqoop 1</strong> – Because of the changes introduced in Sqoop metastore logic, the metastore database that is created by the CDH 6.x version of Sqoop cannot be used by earlier versions.</li>
<li><strong>Sqoop 2</strong> – As described in the upgrade process, Sqoop2 had to be stopped and deleted before the upgrade process and therefore will not be available after the rollback.</li>
<li><strong>Kafka</strong> – Once the Kafka log format and protocol version configurations (the inter.broker.protocol.version and log.message.format.version properties) are set to the new version (or left blank, which means to use the latest version), <em>Kafka rollback is not possible</em>.</li>
</ul>
<h4 id="3-2-停止服务"><a href="#3-2-停止服务" class="headerlink" title="3.2.停止服务"></a>3.2.停止服务</h4><p><img src="images/cdh01.png" alt></p>
<p><img src="images/cdh02.png" alt></p>
<h4 id="3-3-回滚CDH"><a href="#3-3-回滚CDH" class="headerlink" title="3.3.回滚CDH"></a>3.3.回滚CDH</h4><ul>
<li>回滚Parcel</li>
</ul>
<p><img src="images/rb01.png" alt></p>
<p><img src="images/rb02.png" alt></p>
<p><img src="images/rb02-1.png" alt></p>
<p><img src="images/rb03.png" alt></p>
<p><strong>点击激活会弹出对话框，选择第二个选项，仅激活，如果不小心选择了第一个选项，开始下面步骤前，先停止服务。</strong></p>
<ul>
<li>还原ZooKeeper（所有主机）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -fr /var/lib/zookeeper/</span><br><span class="line">cp -rp /var/lib/zookeeper-backup-`date +%F`CM6.1.0-CDH6.0.0 /var/lib/zookeeper</span><br></pre></td></tr></table></figure>
<p>通过CM启动zookeeper</p>
<ul>
<li><p>回滚HDFS</p>
<ul>
<li>对于开启了HA的HDFS回滚Journal Nodes</li>
</ul>
<ol>
<li><p>登录每个Journal Node节点主机，运行下面命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -fr /data/dfs/jn/nameservice1/current/*</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rp /data/dfs/jn-CM6.1.0-CDH6.0.0/nameservice1/current/* /data/dfs/jn/nameservice1/current/</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过CM启动JournalNodes角色</p>
<p><img src="images/rb04.png" alt></p>
</li>
</ol>
<p><img src="images/rb05.png" alt></p>
<p><img src="images/rb06.png" alt></p>
<ul>
<li><p>回滚 NameNode（NameNode角色主机执行）</p>
<ul>
<li><p>编辑<code>/etc/hadoop/conf.rollback.namenode/hdfs-site.xml</code>文件</p>
<p>a. 删除  <code>cloudera.navigator.client.config</code> 配置项</p>
<p>b. 删除<code>dfs.namenode.audit.loggers</code> 配置项</p>
<p>c. 按如下格式编辑 <code>dfs.hosts</code> 配置项 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Original version of the dfs.hosts property:</span></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.hosts&lt;/name&gt;</span><br><span class="line">&lt;value&gt;/var/run/cloudera-scm-agent/process/63-hdfs-NAMENODE/dfs_all_hosts.txt&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># New version of the dfs.hosts property:</span></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.hosts&lt;/name&gt;</span><br><span class="line">&lt;value&gt;/etc/hadoop/conf.rollback.namenode/dfs_all_hosts.txt&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>/etc/hadoop/conf.rollback.namenode/core-site.xml</code>文件，按如下格式修改<code>net.topology.script.file.name</code>配置项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Original property</span></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;net.topology.script.file.name&lt;/name&gt;</span><br><span class="line">&lt;value&gt;/var/run/cloudera-scm-agent/process/63-hdfs-NAMENODE/topology.py&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>按如下格式编辑<code>/etc/hadoop/conf.rollback.namenode/topology.py</code>文件的<code>MAP_FILE</code>项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAP_FILE = <span class="string">'/etc/hadoop/conf.rollback.namenode/topology.map'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>执行下面命令回滚:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u hdfs hdfs --config /etc/hadoop/conf.rollback.namenode namenode -rollback</span><br></pre></td></tr></table></figure>
<p><strong>有可能报错建立目录失败，手动建立下日志目录，并修改下目录权限777，然后执行回滚，回滚会提示是否需要回滚，选择Y，最后提前启动Namenode失败，继续执行下面步骤</strong></p>
</li>
<li><p>通过CM重启所有的NameNodes 和 JournalNodes 实例</p>
<p><img src="images/rb07.png" alt></p>
</li>
</ul>
</li>
<li><p>回滚DataNode</p>
<ul>
<li><p>编辑<code>/etc/hadoop/conf.rollback.datanode/hdfs-site.xml</code> 移除<code>dfs.datanode.max.locked.memory</code>属性</p>
</li>
<li><p>运行如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/cloudera/parcels/CDH-6.0.0-1.cdh6.0.0.p0.537114/lib/hadoop/logs</span><br><span class="line">chmod 777 /opt/cloudera/parcels/CDH-6.0.0-1.cdh6.0.0.p0.537114/lib/hadoop/logs</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/hadoop/conf.rollback.datanode</span><br><span class="line">sudo -u hdfs hdfs --config /etc/hadoop/conf.rollback.datanode datanode -rollback</span><br></pre></td></tr></table></figure>
<p><img src="images/rb08.png" alt></p>
<p><img src="images/rb09.png" alt></p>
<p>回滚完成后通过<code>CTRL</code> + <code>C</code>返回终端</p>
<p><img src="images/rb10.png" alt></p>
</li>
<li><p>对于HA的HDFS，通过CM重启HDFS服务，非HA的HDFS重启所有的DataNode角色。</p>
</li>
<li><p>(非HA的HDFS回滚Secondary NameNode )If high availability is not enabled for HDFS, roll back the Secondary NameNode.</p>
<ol>
<li><p>(Clusters with TLS enabled only) Edit the<code>/etc/hadoop/conf.rollback.secondarynamenode/ssl-server.xml</code></p>
<p>file on all Secondary NameNode hosts (Located in the temporary rollback directory.) and update the keystore passwords with the actual cleartext passwords.</p>
<p>The passwords will have values that look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;ssl.server.keystore.password&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;********&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;ssl.server.keystore.keypassword&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;********&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>(TLS only) Edit the /etc/hadoop/conf.rollback.secondarynamenode/ssl-server.xml file and remove the hadoop.security.credential.provider.path property.</p>
</li>
<li><p>Log in to the Secondary NameNode host and run the following commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /dfs/snn/*</span><br><span class="line">cd /etc/hadoop/conf.rollback.secondarynamenode/</span><br><span class="line">sudo -u hdfs hdfs --config /etc/hadoop/conf.rollback.secondarynamenode secondarynamenode -format</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Restart the HDFS service. Open the Cloudera Manager Admin Console, go to the HDFS service page, and select Actions &gt; Restart.</p>
<p>The Restart Command page displays the progress of the restart. Wait for the page to display the Successfully restarted service message before continuing.</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>启动HBase服务</p>
<p>通过CM直接启动HBase服务</p>
</li>
<li><p>回滚数据库</p>
<ul>
<li>Hive Metastore</li>
<li>Hue</li>
<li>Oozie</li>
<li>Sentry Server</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 还原hue</span></span><br><span class="line">mysqldump --databases hue --host=localhost --port=3306 -u hue -p &lt; hue-backup-`date +%F`-CDH6.0.0.sql</span><br><span class="line"><span class="comment"># 还原hive元数据</span></span><br><span class="line">mysqldump --databases metastore --host=localhost --port=3306 -u hive -p &lt; metastore-backup-`date +%F`-CDH6.0.0.sql</span><br><span class="line"><span class="comment"># 还原oozie</span></span><br><span class="line">mysqldump --databases oozie --host=localhost --port=3306 -u oozie -p &lt; oozie-backup-`date +%F`-CDH6.0.0.sql</span><br><span class="line"><span class="comment"># 还原sentry</span></span><br><span class="line">mysqldump --databases sentry --host=localhost --port=3306 -u sentry -p &lt; sentry-backup-`date +%F`-CDH6.0.0.sql</span><br></pre></td></tr></table></figure>
<p><strong>mysqldump恢复sentry库后，重启sentry失败，后来发现mysqldump没恢复成功，可以切换到sentry库下使用source恢复</strong></p>
</li>
<li><p>启动Sentry服务</p>
<p>通过CM直接启动Sentry服务</p>
</li>
<li><p>回滚Hue</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /opt/cloudera/parcels/CDH/lib/hue/app.reg</span><br><span class="line">cp -rp  /opt/cloudera/parcels_backup/app.reg-CM6.1.0-CDH6.0.0  /opt/cloudera/parcels/CDH/lib/hue/app.reg</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新部署客户端配置</p>
<p><img src="images/rb11.png" alt></p>
</li>
<li><p>重启集群</p>
<p><img src="images/rb12.png" alt></p>
</li>
</ul>
<p><img src="images/rb13.png" alt></p>
<ul>
<li>回滚CDH版本后，会导致Oozie的共享库版本与CDH版本不匹配问题，需要降级Oozie的共享库</li>
</ul>
<p><img src="images/rb17.png" alt></p>
<p><img src="images/rb18.png" alt></p>
<p><img src="images/rb19.png" alt></p>
<p><img src="images/rb20.png" alt></p>
<p><img src="images/rb21.png" alt></p>
<p><img src="images/rb22.png" alt></p>
<p><img src="images/rb23.png" alt></p>
<h4 id="3-4-检查服务和数据"><a href="#3-4-检查服务和数据" class="headerlink" title="3.4.检查服务和数据"></a>3.4.检查服务和数据</h4><ul>
<li>Hue数据检查</li>
</ul>
<p>升级前的数据</p>
<p><img src="images/old.png" alt></p>
<p>回滚后的数据</p>
<p><img src="images/rb14.png" alt></p>
<p>创建表</p>
<p><img src="images/rb15.png" alt></p>
<p>插入数据</p>
<p><img src="images/rb16.png" alt></p>
<p><strong>至此CDH的回滚完成</strong></p>

      
    </div>
    
    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0升级6.1.0步骤/" rel="next" title>
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/16/Centos7离线部署 CDH5/" rel="prev" title>
                 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lynnyq</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#CDH6-0-0升级6-1-0步骤"><span class="nav-number">1.</span> <span class="nav-text">CDH6.0.0升级6.1.0步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-CM升级"><span class="nav-number">1.1.</span> <span class="nav-text">1.CM升级</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-升级概述"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1.升级概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-下载文件"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2.下载文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-备份"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3.备份</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-1-收集信息"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">1.3.1.收集信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-2-备份CM-Agent"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">1.3.2.备份CM Agent</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-3-备份Cloudera-Management-Service"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">1.3.3.备份Cloudera Management Service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-4-停止CM相关服务"><span class="nav-number">1.1.3.4.</span> <span class="nav-text">1.3.4.停止CM相关服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-5-备份CM数据库（mysql机器上执行）"><span class="nav-number">1.1.3.5.</span> <span class="nav-text">1.3.5.备份CM数据库（mysql机器上执行）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-6-备份CM其他相关服务的数据库（mysql机器上执行）"><span class="nav-number">1.1.3.6.</span> <span class="nav-text">1.3.6.备份CM其他相关服务的数据库（mysql机器上执行）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-7-备份Cloudera-Manager-Server（CM机器上执行）"><span class="nav-number">1.1.3.7.</span> <span class="nav-text">1.3.7.备份Cloudera Manager Server（CM机器上执行）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-升级Cloudera-Manager-Server"><span class="nav-number">1.1.4.</span> <span class="nav-text">1.4.升级Cloudera Manager Server</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-CDH升级"><span class="nav-number">1.2.</span> <span class="nav-text">2.CDH升级</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-准备安装包"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1.准备安装包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-服务检查"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2.服务检查</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-进入维护模式"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3.进入维护模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-备份数据库"><span class="nav-number">1.2.4.</span> <span class="nav-text">2.4.备份数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-备份ZooKeeper-所有节点"><span class="nav-number">1.2.5.</span> <span class="nav-text">2.5.备份ZooKeeper(所有节点)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-备份数据"><span class="nav-number">1.2.6.</span> <span class="nav-text">2.6.备份数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-7-向集群中添加新版的CDH存储库"><span class="nav-number">1.2.7.</span> <span class="nav-text">2.7.向集群中添加新版的CDH存储库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-运行升级向导开始升级"><span class="nav-number">1.2.8.</span> <span class="nav-text">2.8.运行升级向导开始升级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-9-功能验证"><span class="nav-number">1.2.9.</span> <span class="nav-text">2.9.功能验证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-10-最终化元数据升级"><span class="nav-number">1.2.10.</span> <span class="nav-text">2.10.最终化元数据升级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CDH回滚"><span class="nav-number">1.3.</span> <span class="nav-text">3.CDH回滚</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-回滚限制"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1.回滚限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-停止服务"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2.停止服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-回滚CDH"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3.回滚CDH</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-检查服务和数据"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4.检查服务和数据</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lynnyq</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
