<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="hello">










<meta name="description" content="Centos7离线部署 CDH5[TOC] 1.安装之前 CDH 5 和 CM 5 的依赖和支持的版本  硬件要求指南 How-to: Select the Right Hardware for Your New Hadoop Cluster  Before You Install   安装之前建议阅读如上官方安装指南 2.准备工作 3台16核32G内存260G硬盘CentOS 7机器 机器规划：">
<meta property="og:type" content="article">
<meta property="og:title" content="lynnyq">
<meta property="og:url" content="http://yoursite.com/2019/02/16/Centos7离线部署 CDH5/index.html">
<meta property="og:site_name" content="lynnyq">
<meta property="og:description" content="Centos7离线部署 CDH5[TOC] 1.安装之前 CDH 5 和 CM 5 的依赖和支持的版本  硬件要求指南 How-to: Select the Right Hardware for Your New Hadoop Cluster  Before You Install   安装之前建议阅读如上官方安装指南 2.准备工作 3台16核32G内存260G硬盘CentOS 7机器 机器规划：">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/hostname01.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/hostname02.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/selinux.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/jdk_version.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cm01.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cm02.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cm03.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cm04.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cm05.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cm06.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cdh01.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cdh02.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cdh03.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cdh04.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cdh05.png">
<meta property="og:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/cdh06.png">
<meta property="og:updated_time" content="2019-02-16T15:32:13.122Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lynnyq">
<meta name="twitter:description" content="Centos7离线部署 CDH5[TOC] 1.安装之前 CDH 5 和 CM 5 的依赖和支持的版本  硬件要求指南 How-to: Select the Right Hardware for Your New Hadoop Cluster  Before You Install   安装之前建议阅读如上官方安装指南 2.准备工作 3台16核32G内存260G硬盘CentOS 7机器 机器规划：">
<meta name="twitter:image" content="http://yoursite.com/2019/02/16/Centos7离线部署%20CDH5/images/hostname01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/02/16/Centos7离线部署 CDH5/">





  <title> | lynnyq</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/lynnyq" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lynnyq</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/16/Centos7离线部署 CDH5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lynnyq">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lynnyq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline"></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-16T23:32:13+08:00">
                2019-02-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Centos7离线部署-CDH5"><a href="#Centos7离线部署-CDH5" class="headerlink" title="Centos7离线部署 CDH5"></a>Centos7离线部署 CDH5</h2><p>[TOC]</p>
<h3 id="1-安装之前"><a href="#1-安装之前" class="headerlink" title="1.安装之前"></a>1.安装之前</h3><ul>
<li><p><a href="https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html" target="_blank" rel="noopener">CDH 5 和 CM 5 的依赖和支持的版本</a></p>
</li>
<li><p><a href="https://www.cloudera.com/documentation/enterprise/release-notes/topics/hardware_requirements_guide.html" target="_blank" rel="noopener">硬件要求指南</a></p>
<p><a href="http://blog.cloudera.com/blog/2013/08/how-to-select-the-right-hardware-for-your-new-hadoop-cluster/" target="_blank" rel="noopener">How-to: Select the Right Hardware for Your New Hadoop Cluster</a></p>
</li>
<li><p><a href="https://www.cloudera.com/documentation/enterprise/5-15-x/topics/installation_reqts.html" target="_blank" rel="noopener">Before You Install</a></p>
</li>
</ul>
<p><strong>安装之前建议阅读如上官方安装指南</strong></p>
<h3 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2.准备工作"></a>2.准备工作</h3><ul>
<li><p>3台16核32G内存260G硬盘CentOS 7机器</p>
<p>机器规划：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>HostName</th>
<th>角色</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>cdh001</td>
<td>CM节点，NameNode，Active Monitor,DataNode</td>
<td>192.168.31.151</td>
</tr>
<tr>
<td>cdh002</td>
<td>DataNode、 JobTracker</td>
<td>192.168.31.152</td>
</tr>
<tr>
<td>cdh003</td>
<td>DataNode、 JobTracker</td>
<td>192.168.31.153</td>
</tr>
</tbody>
</table>
<ul>
<li><p>CDH离线包</p>
<p><a href="http://archive.cloudera.com/cdh5/parcels/5.15.1.4/" target="_blank" rel="noopener">CDH下载地址</a></p>
<ul>
<li><a href="http://archive.cloudera.com/cdh5/parcels/5.15.1.4/CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel" target="_blank" rel="noopener">CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel</a></li>
<li><a href="http://archive.cloudera.com/cdh5/parcels/5.15.1.4/CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel.sha1" target="_blank" rel="noopener">CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel.sha1</a> <strong>(注意下载后需要重命名为**.sha,否则安装parcel的时候会在线下载)</strong></li>
<li><a href="http://archive.cloudera.com/cdh5/parcels/5.15.1.4/manifest.json" target="_blank" rel="noopener">manifest.json</a> </li>
</ul>
</li>
<li><p>JDK1.8u162</p>
<ul>
<li><a href="https://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html" target="_blank" rel="noopener">下载地址</a></li>
</ul>
</li>
<li><p>JDBC</p>
<ul>
<li><a href="http://www.mysql.com/downloads/connector/j/5.1.html" target="_blank" rel="noopener">下载地址</a></li>
</ul>
</li>
<li><p>操作系统依赖</p>
<ul>
<li><p>psmisc    </p>
<p><em>CM客户端和服务端启动脚本会使用pstree命令，不安装会报找不到命令</em></p>
</li>
<li><p>libxslt-devel libxml2-devel</p>
<p><em>不安装的话Hue安装时测试MySQL会报错</em></p>
</li>
<li><p>krb5-devel cyrus-sasl-gssapi cyrus-sasl-deve</p>
<p>Kerberos相关依赖</p>
</li>
<li><p>openldap-devel python-devel</p>
<p>相关开发依赖</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有节点安装</span></span><br><span class="line">yum install -y psmisc libxslt-devel libxml2-devel krb5-devel cyrus-sasl-gssapi cyrus-sasl-deve openldap-devel python-devel wget</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-CM安装"><a href="#3-CM安装" class="headerlink" title="3.CM安装"></a>3.CM安装</h3><h4 id="3-1-网络配置"><a href="#3-1-网络配置" class="headerlink" title="3.1.网络配置"></a>3.1.网络配置</h4><ul>
<li><p>修改主机名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分别在对应机器上执行</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname cdh01</span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname cdh02</span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname cdh03</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="images/hostname01.png" alt="设置hostname"></p>
<ul>
<li><p>配置hosts文件 (所有节点)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line"></span><br><span class="line">192.168.31.151 cdh01</span><br><span class="line">192.168.31.152 cdh02</span><br><span class="line">192.168.31.153 cdh03</span><br></pre></td></tr></table></figure>
<p><img src="images/hostname02.png" alt="设置hosts"></p>
</li>
</ul>
<ul>
<li>配置ssh免密登录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在cdh01上执行</span></span><br><span class="line">ssh-keygen</span><br><span class="line"><span class="comment"># 一路回车默认在~/.ssh目录下生成RSA密钥对id_rsa(私钥)，id_rsa.pub（公钥）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加公钥认证</span></span><br><span class="line">ssh-copy-id -i cdh01</span><br><span class="line">ssh-copy-id -i cdh02</span><br><span class="line">ssh-copy-id -i cdh03</span><br><span class="line"><span class="comment"># 输入机器用户密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝密钥对到各个机器上去</span></span><br><span class="line">scp -r ~/.ssh/ cdh01:~/</span><br><span class="line">scp -r ~/.ssh/ cdh02:~/</span><br><span class="line">scp -r ~/.ssh/ cdh03:~/</span><br></pre></td></tr></table></figure>
<ul>
<li>关闭防火墙 （所有节点）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查防火墙状态</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># 设置防火墙开机不自启 </span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>
<ul>
<li>关闭selinux（所有节点）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭selinux</span></span><br><span class="line">setenforce 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开机不自启</span></span><br><span class="line">vi /etc/selinux/config</span><br><span class="line"><span class="comment"># 修改"SELINUX=enforcing"为"SELINUX=disabled"</span></span><br><span class="line">SELINUX=disabled</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 SELINUX 状态：</span></span><br><span class="line">/usr/sbin/sestatus –v</span><br><span class="line"><span class="comment"># SELinux status: enabled（enabled：开启；disabled：关闭）</span></span><br></pre></td></tr></table></figure>
<p><img src="images/selinux.png" alt></p>
<h4 id="3-2-JDK安装"><a href="#3-2-JDK安装" class="headerlink" title="3.2.JDK安装"></a>3.2.JDK安装</h4><ul>
<li><p>官方JDK安装要求</p>
<ul>
<li>The JDK <strong>must be 64-bit</strong>. Do not use a 32-bit JDK.</li>
<li>The installed JDK must be a supported version as documented in <a href="https://www.cloudera.com/documentation/enterprise/5-15-x/topics/rn_consolidated_pcm.html#pcm_jdk" target="_blank" rel="noopener">CDH and Cloudera Manager Supported JDK Versions</a>.<ul>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html" target="_blank" rel="noopener">Oracle JDK 7</a> is supported across all versions of Cloudera Manager 5 and CDH 5.</li>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html" target="_blank" rel="noopener">Oracle JDK 8</a> is supported in C5.3.x and higher.</li>
<li>Oracle JDK 9 is not supported in any Cloudera Manager or CDH version.</li>
</ul>
</li>
<li>The <em>same version</em> of the Oracle JDK must be installed on each cluster host.</li>
<li>The JDK must be installed at <strong>/usr/java/jdk-version</strong>.</li>
</ul>
<blockquote>
<p><strong>Important</strong>:The RHEL-compatible and Ubuntu operating systems supported by Cloudera Enterprise all use AES-256 encryption by default for tickets. To support AES-256 bit encryption in JDK versions lower than <strong>1.8u161</strong>, you must install the <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy File</a> on all cluster and Hadoop user machines. Cloudera Manager can automatically install the policy files, or you can install them manually. For JCE Policy File installation instructions, see the README.txtfile included in the jce_policy-x.zip file. JDK 1.8u161 and higher enable unlimited strength encryption by default, and do not require policy files.On SLES platforms, do not install or try to use the IBM Java version bundled with the SLES distribution. CDH does not run correctly with that version.  </p>
</blockquote>
<p><strong>根据<a href="https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html#concept_ihg_vf4_j1b" target="_blank" rel="noopener">官方指南</a>因此本次安装选择JDK充分测试过且支持的最高版本JDK1.8u162</strong></p>
</li>
</ul>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传下载的jdk到cdh01机器上</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动到/opt/java目录下</span></span><br><span class="line">mkdir /usr/java/</span><br><span class="line">tar zxvf jdk-8u162-linux-x64.tar.gz -C /usr/java/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="comment"># 在最末尾加上</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for jdk</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_162</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生效环境变量</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># 检查是否生效</span></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将jdk拷贝到其他节点上去</span></span><br><span class="line">scp -r /usr/java/ cdh02:/usr/</span><br><span class="line">scp -r /usr/java/ cdh03:/usr/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝环境变量到其他节点上去</span></span><br><span class="line">scp /etc/profile cdh02:/etc/</span><br><span class="line">scp /etc/profile cdh03:/etc/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在其他节点检查jdk环境是否生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
<p><img src="images/jdk_version.png" alt="jdk版本"></p>
<h4 id="3-3-配置ntp"><a href="#3-3-配置ntp" class="headerlink" title="3.3.配置ntp"></a>3.3.配置ntp</h4><p><a href="https://www.cloudera.com/documentation/enterprise/5-15-x/topics/install_cdh_enable_ntp.html" target="_blank" rel="noopener">官方文档</a></p>
<ul>
<li><p>安装ntp（所有节点）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y ntp</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置</p>
<ul>
<li><p>cdh01节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cdh01主节点配置</span></span><br><span class="line">vi /etc/ntp.conf</span><br><span class="line"><span class="comment"># 注释默认的server,添加以下server</span></span><br><span class="line">server 210.72.145.44 perfer   <span class="comment"># 中国国家受时中心</span></span><br><span class="line">server 202.112.10.36             <span class="comment"># 1.cn.pool.ntp.org</span></span><br><span class="line">server 59.124.196.83             <span class="comment"># 0.asia.pool.ntp.org</span></span><br><span class="line">server  127.127.1.0     <span class="comment"># local clock</span></span><br><span class="line">fudge   127.127.1.0 stratum 10</span><br></pre></td></tr></table></figure>
</li>
<li><p>cdh02、cdh03节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ntp.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 子节点把所有server行注释掉，添加下面一行</span></span><br><span class="line">server cdh01</span><br></pre></td></tr></table></figure>
</li>
<li><p>所有节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start ntpd</span><br><span class="line">systemctl <span class="built_in">enable</span> ntpd</span><br><span class="line">ntpstat</span><br></pre></td></tr></table></figure>
<blockquote>
<p>synchronised to NTP server (192.168.31.151) at stratum 12<br>   time correct to within 909 ms<br>   polling server every 64 s</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="3-4-cdh01节点安装配置MySQL"><a href="#3-4-cdh01节点安装配置MySQL" class="headerlink" title="3.4.cdh01节点安装配置MySQL"></a>3.4.cdh01节点安装配置MySQL</h4><ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">yum update</span><br><span class="line">yum install mysql-server</span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>
<ul>
<li>配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysqld</span><br><span class="line">cp /etc/my.cnf /etc/my.cnf.default</span><br><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除原有配置，并修改为如下建议配置</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">transaction-isolation = READ-COMMITTED</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks;</span></span><br><span class="line"><span class="comment"># to do so, uncomment this line:</span></span><br><span class="line">symbolic-links = 0</span><br><span class="line"></span><br><span class="line">key_buffer_size = 32M</span><br><span class="line">max_allowed_packet = 32M</span><br><span class="line">thread_stack = 256K</span><br><span class="line">thread_cache_size = 64</span><br><span class="line">query_cache_limit = 8M</span><br><span class="line">query_cache_size = 64M</span><br><span class="line">query_cache_type = 1</span><br><span class="line"></span><br><span class="line">max_connections = 550</span><br><span class="line"><span class="comment">#expire_logs_days = 10</span></span><br><span class="line"><span class="comment">#max_binlog_size = 100M</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#log_bin should be on a disk with enough free space.</span></span><br><span class="line"><span class="comment">#Replace '/var/lib/mysql/mysql_binary_log' with an appropriate path for your</span></span><br><span class="line"><span class="comment">#system and chown the specified folder to the mysql user.</span></span><br><span class="line">log_bin=/var/lib/mysql/mysql_binary_log</span><br><span class="line"></span><br><span class="line"><span class="comment">#In later versions of MySQL, if you enable the binary log and do not set</span></span><br><span class="line"><span class="comment">#a server_id, MySQL will not start. The server_id must be unique within</span></span><br><span class="line"><span class="comment">#the replicating group.</span></span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line">binlog_format = mixed</span><br><span class="line"></span><br><span class="line">read_buffer_size = 2M</span><br><span class="line">read_rnd_buffer_size = 16M</span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line">join_buffer_size = 8M</span><br><span class="line"></span><br><span class="line"><span class="comment"># InnoDB settings</span></span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_flush_log_at_trx_commit  = 2</span><br><span class="line">innodb_log_buffer_size = 64M</span><br><span class="line">innodb_buffer_pool_size = 4G</span><br><span class="line">innodb_thread_concurrency = 8</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_log_file_size = 512M</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line"><span class="built_in">log</span>-error=/var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br><span class="line">sql_mode=STRICT_ALL_TABLES</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>
<ul>
<li>设置root密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysql_secure_installation</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line">Enter current password <span class="keyword">for</span> root (enter <span class="keyword">for</span> none):</span><br><span class="line">OK, successfully used password, moving on...</span><br><span class="line">[...]</span><br><span class="line">Set root password? [Y/n] Y</span><br><span class="line">New password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">Remove anonymous users? [Y/n] Y</span><br><span class="line">[...]</span><br><span class="line">Disallow root login remotely? [Y/n] N</span><br><span class="line">[...]</span><br><span class="line">Remove <span class="built_in">test</span> database and access to it [Y/n] Y</span><br><span class="line">[...]</span><br><span class="line">Reload privilege tables now? [Y/n] Y</span><br><span class="line">All <span class="keyword">done</span>!</span><br></pre></td></tr></table></figure>
<ul>
<li>安装配置MySQL JDBC 驱动</li>
</ul>
<p>下载 .tar.gz格式的文件地址：<a href="http://www.mysql.com/downloads/connector/j/5.1.html" target="_blank" rel="noopener">http://www.mysql.com/downloads/connector/j/5.1.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-5.1.47.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf mysql-connector-java-5.1.47.tar.gz</span><br><span class="line"></span><br><span class="line">mkdir -p /usr/share/java/</span><br><span class="line"></span><br><span class="line">cp mysql-connector-java-5.1.47/mysql-connector-java-5.1.47-bin.jar \</span><br><span class="line"> /usr/share/java/mysql-connector-java.jar</span><br><span class="line"> </span><br><span class="line">scp -r /usr/share/java/ cdh02:/usr/share/</span><br><span class="line">scp -r /usr/share/java/ cdh03:/usr/share/</span><br></pre></td></tr></table></figure>
<ul>
<li>创建对应服务数据库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE hue DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span><br><span class="line">GRANT ALL ON hue.* TO &apos;hue&apos;@&apos;%&apos; IDENTIFIED BY &apos;hue&apos;;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE metastore DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span><br><span class="line">GRANT ALL ON metastore.* TO &apos;hive&apos;@&apos;%&apos; IDENTIFIED BY &apos;hive&apos;;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE sentry DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span><br><span class="line">GRANT ALL ON sentry.* TO &apos;sentry&apos;@&apos;%&apos; IDENTIFIED BY &apos;sentry&apos;;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE oozie DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span><br><span class="line">GRANT ALL ON oozie.* TO &apos;oozie&apos;@&apos;%&apos; IDENTIFIED BY &apos;oozie&apos;;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE am DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span><br><span class="line">GRANT ALL ON am.* TO &apos;am&apos;@&apos;%&apos; IDENTIFIED BY &apos;am&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="3-5-创建用户-cloudera-scm-（-所有-节点）"><a href="#3-5-创建用户-cloudera-scm-（-所有-节点）" class="headerlink" title="3.5. 创建用户 cloudera-scm （ 所有 节点）"></a>3.5. 创建用户 cloudera-scm （ 所有 节点）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd --system --home=/opt/cm-5.15.1/run/cloudera-scm-server/ --no-create-home --bash=/bin/<span class="literal">false</span> --comment <span class="string">"Cloudera SCM User"</span> cloudera-scm</span><br></pre></td></tr></table></figure>
<h4 id="3-6-解压CM包"><a href="#3-6-解压CM包" class="headerlink" title="3.6.解压CM包"></a>3.6.解压CM包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cdh01节点</span></span><br><span class="line">mkdir -p /opt/cloudera/parcel-repo</span><br><span class="line">tar -zxvf cloudera-manager-centos7-cm5.15.1_x86_64.tar.gz -C /opt/</span><br><span class="line">mv CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel.sha CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel manifest.json /opt/cloudera/parcel-repo/</span><br><span class="line"></span><br><span class="line">chown -R cloudera-scm:cloudera-scm /opt/cm-5.15.1/</span><br><span class="line">chown -R cloudera-scm:cloudera-scm /opt/cloudera/</span><br><span class="line">mkdir /var/lib/cloudera-scm-server</span><br><span class="line">chown -R cloudera-scm:cloudera-scm /var/lib/cloudera-scm-server</span><br></pre></td></tr></table></figure>
<h4 id="3-7-修改agent配置"><a href="#3-7-修改agent配置" class="headerlink" title="3.7.修改agent配置"></a>3.7.修改agent配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cdh01节点</span></span><br><span class="line">vi /opt/cm-5.15.1/etc/cloudera-scm-agent/config.ini</span><br><span class="line">server_host=cdh01</span><br></pre></td></tr></table></figure>
<h4 id="3-8-拷贝CM包到所有节点"><a href="#3-8-拷贝CM包到所有节点" class="headerlink" title="3.8.拷贝CM包到所有节点"></a>3.8.拷贝CM包到所有节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cdh01节点</span></span><br><span class="line">scp -r /opt/cm-5.15.1/ cdh02:/opt/</span><br><span class="line">scp -r /opt/cm-5.15.1/ cdh03:/opt/</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cdh02、cdh03节点</span></span><br><span class="line">mkdir -p /opt/cloudera/parcel-repo</span><br><span class="line">chown -R cloudera-scm:cloudera-scm /opt/cloudera/</span><br></pre></td></tr></table></figure>
<h4 id="3-9-cdh01节点初始化数据库"><a href="#3-9-cdh01节点初始化数据库" class="headerlink" title="3.9.cdh01节点初始化数据库"></a>3.9.cdh01节点初始化数据库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cdh01节点</span></span><br><span class="line">/opt/cm-5.15.1/share/cmf/schema/scm_prepare_database.sh mysql -hlocalhost -uroot -p123456 --scm-host localhost scm scm scm</span><br></pre></td></tr></table></figure>
<h4 id="3-10-启动服务"><a href="#3-10-启动服务" class="headerlink" title="3.10.启动服务"></a>3.10.启动服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cdh01节点启动cm服务端</span></span><br><span class="line">/opt/cm-5.15.1/etc/init.d/cloudera-scm-server start</span><br><span class="line"><span class="comment"># 查看启动日志</span></span><br><span class="line">tail -f /opt/cm-5.15.1/<span class="built_in">log</span>/cloudera-scm-server/cloudera-scm-server.log </span><br><span class="line"><span class="comment"># 查看到如下日志服务启动完成</span></span><br><span class="line">com.cloudera.server.cmf.WebServerImpl: Started Jetty server.</span><br><span class="line"></span><br><span class="line"><span class="comment"># cdh01、cdh02、cdh03节点启动客户端</span></span><br><span class="line">/opt/cm-5.15.1/etc/init.d/cloudera-scm-agent start</span><br></pre></td></tr></table></figure>
<h4 id="3-11-初始化CM"><a href="#3-11-初始化CM" class="headerlink" title="3.11.初始化CM"></a>3.11.初始化CM</h4><ul>
<li><p>访问CM web界面</p>
<p><a href="http://192.168.31.151:7180/" target="_blank" rel="noopener">http://192.168.31.151:7180/</a></p>
<p>用户：admin</p>
<p>密码：admin</p>
</li>
<li><p>配置CM</p>
<p><img src="images/cm01.png" alt></p>
<p><img src="images/cm02.png" alt></p>
<p><img src="images/cm03.png" alt></p>
<p><img src="images/cm04.png" alt></p>
</li>
</ul>
<p><img src="images/cm05.png" alt>    </p>
<p><img src="images/cm06.png" alt></p>
<p><strong>此处会报两个错误：内存交换空间设置和启用了透明大页面压缩，点击【查看详细信息】查看需要修改设置的主机</strong> </p>
<ul>
<li><p>将机器设置成cloudera官方建议的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sysctl vm.swappiness=10</span><br><span class="line"></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/sysctl.conf加入或修改vm.swappiness配置</span></span><br><span class="line">vm.swappiness=10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使配置生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag'</span> &gt;&gt; /etc/rc.local</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled'</span> &gt;&gt; /etc/rc.local</span><br><span class="line">cat /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class="line"><span class="comment"># to run scripts during boot instead of using this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class="line"><span class="comment"># this script will NOT be run after all other services.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span></span><br><span class="line"><span class="comment"># that this script will be executed during boot.</span></span><br><span class="line"></span><br><span class="line">touch /var/lock/subsys/<span class="built_in">local</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure>
<p><strong>修改完成重新运行检查主机检查，此时警告消除点击【完成】。</strong></p>
</li>
</ul>
<h3 id="4-安装CDH服务"><a href="#4-安装CDH服务" class="headerlink" title="4.安装CDH服务"></a>4.安装CDH服务</h3><ul>
<li>选择服务</li>
</ul>
<p><img src="images/cdh01.png" alt></p>
<ul>
<li>配置角色</li>
</ul>
<p><img src="images/cdh02.png" alt></p>
<ul>
<li>设置数据库连接</li>
</ul>
<p><img src="images/cdh03.png" alt></p>
<ul>
<li>集群设置</li>
</ul>
<p><img src="images/cdh04.png" alt></p>
<ul>
<li>开始安装</li>
</ul>
<p><img src="images/cdh05.png" alt></p>
<ul>
<li>完成安装</li>
</ul>
<p><img src="images/cdh06.png" alt></p>

      
    </div>
    
    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/16/CDH6.0.0update6.1.0/CDH6.0.0不停止服务升级6.1.0/" rel="next" title>
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/16/Centos7在线部署CDH5/" rel="prev" title>
                 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">lynnyq</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Centos7离线部署-CDH5"><span class="nav-number">1.</span> <span class="nav-text">Centos7离线部署 CDH5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-安装之前"><span class="nav-number">1.1.</span> <span class="nav-text">1.安装之前</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-准备工作"><span class="nav-number">1.2.</span> <span class="nav-text">2.准备工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CM安装"><span class="nav-number">1.3.</span> <span class="nav-text">3.CM安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-网络配置"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1.网络配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-JDK安装"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2.JDK安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-配置ntp"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3.配置ntp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-cdh01节点安装配置MySQL"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4.cdh01节点安装配置MySQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-创建用户-cloudera-scm-（-所有-节点）"><span class="nav-number">1.3.5.</span> <span class="nav-text">3.5. 创建用户 cloudera-scm （ 所有 节点）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-解压CM包"><span class="nav-number">1.3.6.</span> <span class="nav-text">3.6.解压CM包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-修改agent配置"><span class="nav-number">1.3.7.</span> <span class="nav-text">3.7.修改agent配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-8-拷贝CM包到所有节点"><span class="nav-number">1.3.8.</span> <span class="nav-text">3.8.拷贝CM包到所有节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-cdh01节点初始化数据库"><span class="nav-number">1.3.9.</span> <span class="nav-text">3.9.cdh01节点初始化数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-10-启动服务"><span class="nav-number">1.3.10.</span> <span class="nav-text">3.10.启动服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-11-初始化CM"><span class="nav-number">1.3.11.</span> <span class="nav-text">3.11.初始化CM</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-安装CDH服务"><span class="nav-number">1.4.</span> <span class="nav-text">4.安装CDH服务</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lynnyq</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
